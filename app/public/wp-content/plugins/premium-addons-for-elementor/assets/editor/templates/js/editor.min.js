(s=>{var d=window.PremiumTempsData||{},l={ModalLayoutView:null,ModalHeaderView:null,ModalHeaderInsertButton:null,ModalLoadingView:null,ModalBodyView:null,ModalErrorView:null,ModalInvalidLicenseErrorView:null,ModalDisabledElementErrorView:null,LibraryCollection:null,KeywordsModel:null,ModalCollectionView:null,FiltersCollectionView:null,FiltersItemView:null,ModalTemplateItemView:null,ModalInsertTemplateBehavior:null,ModalTemplateModel:null,CategoriesCollection:null,ModalPreviewView:null,ModalHeaderBack:null,ModalHeaderLogo:null,ModalHeaderMenu:null,KeywordsView:null,SearchFieldView:null,TabModel:null,CategoryModel:null,init:function(){var r=this;r.ModalTemplateModel=Backbone.Model.extend({defaults:{template_id:0,name:"",title:"",thumbnail:"",preview:"",source:"",categories:[],keywords:[]}}),r.ModalHeaderView=Marionette.LayoutView.extend({id:"premium-template-modal-header",template:"#tmpl-premium-template-modal-header",ui:{closeModal:"#premium-template-modal-header-close-modal"},events:{"click @ui.closeModal":"onCloseModalClick"},regions:{headerLogo:"#premium-template-modal-header-logo-area",headerTabs:"#premium-template-modal-header-tabs",headerActions:"#premium-template-modal-header-actions"},onCloseModalClick:function(){m.closeModal()}}),r.TabModel=Backbone.Model.extend({defaults:{slug:"",title:""}}),r.LibraryCollection=Backbone.Collection.extend({model:r.ModalTemplateModel}),r.CategoryModel=Backbone.Model.extend({defaults:{slug:"",title:""}}),r.KeywordsModel=Backbone.Model.extend({defaults:{keywords:{},activeKeyword:""}}),r.DisableElementModel=Backbone.Model.extend({defaults:{name:"",url:"",widgetURL:""}}),r.CategoriesCollection=Backbone.Collection.extend({model:r.CategoryModel}),r.KeywordsView=Marionette.ItemView.extend({id:"elementor-template-library-filter",template:"#tmpl-premium-template-modal-keywords",ui:{keywords:".premium-library-keywords"},events:{"change @ui.keywords":"onSelectKeyword"},onSelectKeyword:function(e){e=e.currentTarget.selectedOptions[0].value;m.setFilter("keyword",e)},onRender:function(){this.$(".premium-library-keywords").select2({placeholder:"Choose Widget",allowClear:!0,width:250,dropdownParent:this.$el})}}),r.SearchFieldView=Marionette.ItemView.extend({id:"elementor-template-library-filter-text-wrapper",template:"#tmpl-premium-template-modal-search-field",ui:{searchField:"#elementor-template-library-filter-text"},events:{"keyup @ui.searchField":"onSearchInput"},onSearchInput:function(e){e=s(e.target).val();m.setFilter("search",e)}}),r.ModalPreviewView=Marionette.ItemView.extend({template:"#tmpl-premium-template-modal-preview",id:"premium-templatate-item-preview-wrap",ui:{iframe:"iframe",notice:".premium-template-item-notice"},onRender:function(){var e=this.getOption("notice");if(null!==e&&e.length){var t="";switch(!0){case e.includes("facebook"):t+="<p>Please login with your account in order to get your data.</p>";break;case e.includes("google"):t+="<p>You need to add your Google API key from Dashboard -> Premium Add-ons for Elementor -> Google Maps</p>";break;case e.includes("form"):t+="<p>You need to have <a href='https://wordpress.org/plugins/contact-form-7/' target='_blank'>Contact Form 7 plugin</a> installed and active.</p>";break;case e.includes("woocommerce"):t+="<p>You need to have WooCommerce plugin installed to use this template.</p>"}""!==t&&this.ui.notice.html("<div><p><strong>Important!</strong></p>"+t+"</div>")}this.ui.iframe.attr("src",this.getOption("url"))}}),r.ModalHeaderBack=Marionette.ItemView.extend({template:"#tmpl-premium-template-modal-header-back",id:"premium-template-modal-header-back",ui:{button:"button"},events:{"click @ui.button":"onBackClick"},onBackClick:function(){m.setPreview("back")}}),r.ModalHeaderLogo=Marionette.ItemView.extend({template:"#tmpl-premium-template-modal-header-logo",id:"premium-template-modal-header-logo"}),r.ModalBodyView=Marionette.LayoutView.extend({id:"premium-template-library-content",className:function(){return"library-tab-"+m.getTab()},template:"#tmpl-premium-template-modal-content",regions:{contentTemplates:".premium-templates-list",contentFilters:".premium-filters-list",contentKeywords:".premium-keywords-list",searchField:".premium-templates-search"}}),r.ModalInsertTemplateBehavior=Marionette.Behavior.extend({ui:{insertButtons:[".premium-template-insert",".premium-template-insert-no-media"]},events:{"click @ui.insertButtons":"onInsertButtonClick"},onInsertButtonClick:function(e){var n=this.view.model,t=n.attributes.dependencies,i=n.attributes.pro,o=Object.keys(t).length,a={},l=!s(e.currentTarget).hasClass("premium-template-insert-no-media");if(m.layout.showLoadingView(),0<o)for(var r in t)s.ajax({url:ajaxurl,type:"post",dataType:"json",data:{action:"premium_inner_template",template:r,title:t[r],tab:m.getTab(),withMedia:l}});"valid"!==d.license.status&&i?m.layout.showLicenseError():elementor.templates.requestTemplateContent("premium-api",n.get("template_id"),{data:{tab:m.getTab(),page_settings:!1,withMedia:l},success:function(t){var i=!1;if(t.license)if("invalid"===t.license)m.layout.showInvalidLicenseError();else{console.log("%c Template Inserted Successfully!!","color: #7a7a7a; background-color: #eee;"),null!==m.atIndex&&(a.at=m.atIndex);try{elementor.previewView.addChildModel(t.content,a),$e.run("document/elements/import",{model:n,data:t,options:a})}catch(e){t=e.message,i=-1!==t.indexOf("Element type not found");t=(t=t.replace("Element type not found: ","")).replace(/'/g,""),m.layout.showDisabledElementError(t)}i||m.closeModal(),window.elementor.$previewContents.find(".elementor-add-section .elementor-add-section-close").click(),jQuery("#elementor-panel-saver-button-save-options, #elementor-panel-saver-button-publish").removeClass("elementor-disabled"),m.atIndex=null}else m.layout.showLicenseError()},error:function(e){console.log(e)}})}}),r.ModalHeaderInsertButton=Marionette.ItemView.extend({template:"#tmpl-premium-template-modal-insert-button",id:"premium-template-modal-insert-button",behaviors:{insertTemplate:{behaviorClass:r.ModalInsertTemplateBehavior}}}),r.FiltersItemView=Marionette.ItemView.extend({template:"#tmpl-premium-template-modal-filters-item",className:function(){return"premium-template-filter-item"},ui:function(){return{filterLabels:".premium-template-filter-label"}},events:function(){return{"click @ui.filterLabels":"onFilterClick"}},onFilterClick:function(e){e=jQuery(e.target);jQuery(".premium-library-keywords").val(""),m.setFilter("category",e.val()),m.setFilter("keyword","")}}),r.FiltersCollectionView=Marionette.CompositeView.extend({id:"premium-template-library-filters",template:"#tmpl-premium-template-modal-filters",childViewContainer:"#premium-modal-filters-container",getChildView:function(){return r.FiltersItemView}}),r.ModalTabsView=Marionette.ItemView.extend({template:"#tmpl-premium-template-modal-tabs",id:"elementor-template-library-header-menu",templateHelpers:function(){return{tabs:m.getTabs()}},ui:function(){return{filterTab:".elementor-template-library-menu-item"}},events:function(){return{"click @ui.filterTab":"onTabClick"}},onTabClick:function(e){e=jQuery(e.target);m.setTab(e.data("tab")),m.setFilter("keyword","")}}),r.ModalTemplateItemView=Marionette.ItemView.extend({template:"#tmpl-premium-template-modal-item",className:function(){var e=" premium-template-has-url",t="";return""===this.model.get("preview")&&(e=" premium-template-no-url"),this.model.get("pro")&&(t=" premium-template-pro"),this.model.get("notice")&&-1!==this.model.get("notice").indexOf("container")&&(t+=" premium-template-flexbox"),"elementor-template-library-template elementor-template-library-template-remote"+e+t},ui:function(){return{previewButton:".elementor-template-library-template-preview"}},events:function(){return{"click @ui.previewButton":"onPreviewButtonClick"}},onPreviewButtonClick:function(){""!==this.model.get("url")&&m.setPreview(this.model)},behaviors:{insertTemplate:{behaviorClass:r.ModalInsertTemplateBehavior}}}),r.ModalCollectionView=Marionette.CompositeView.extend({template:"#tmpl-premium-template-modal-templates",id:"premium-template-library-templates",childViewContainer:"#premium-modal-templates-container",initialize:function(){this.listenTo(m.channels.templates,"filter:change",this._renderChildren)},filter:function(e){var t=m.getFilter("category"),i=m.getFilter("keyword"),n=m.getFilter("search");return!(t||i||n)||(n?(e.get("keywords").find(function(e){return-1!=e.indexOf(n)}),e.get("template_id")===parseInt(n)):i&&!t?_.contains(e.get("keywords"),i):t&&!i?_.contains(e.get("categories"),t):_.contains(e.get("categories"),t)&&_.contains(e.get("keywords"),i))},getChildView:function(){return r.ModalTemplateItemView},onRenderCollection:function(){var e,t=this.$childViewContainer,i=this.$childViewContainer.children(),n=m.getTab();"premium_page"!==n&&"local"!==n&&(e=new elementorModules.utils.Masonry({container:t,items:i}),setTimeout(function(){t.imagesLoaded(e.run.bind(e))},1e3))}}),r.ModalLayoutView=Marionette.LayoutView.extend({el:"#premium-template-modal",regions:d.modalRegions,initialize:function(){this.getRegion("modalHeader").show(new r.ModalHeaderView),this.listenTo(m.channels.tabs,"filter:change",this.switchTabs),this.listenTo(m.channels.layout,"preview:change",this.switchPreview)},switchTabs:function(){this.showLoadingView(),m.setFilter("keyword",""),m.requestTemplates(m.getTab())},switchPreview:function(){var e=this.getHeaderView(),t=m.getPreview(),i=m.getFilter("category"),n=m.getFilter("keyword");["back","initial"].includes(t)?(e.headerActions.$el.addClass("header-actions-hidden"),jQuery("#premium-template-modal-header-tabs").removeClass("insert-temp-preview")):(jQuery(".header-actions-hidden").removeClass("header-actions-hidden"),jQuery("#premium-template-modal-header-tabs").addClass("insert-temp-preview")),"back"===t?(e.headerLogo.show(new r.ModalHeaderLogo),e.headerTabs.show(new r.ModalTabsView),e.headerActions.empty(),m.setTab(m.getTab()),""!=i&&(m.setFilter("category",i),jQuery("#premium-modal-filters-container").find("input[value='"+i+"']").prop("checked",!0)),""!=n&&m.setFilter("keyword",n)):"initial"===t?(e.headerActions.empty(),e.headerLogo.show(new r.ModalHeaderLogo)):(this.getRegion("modalContent").show(new r.ModalPreviewView({preview:t.get("preview"),url:t.get("preview_url"),notice:t.get("notice")})),e.headerLogo.empty(),e.headerTabs.show(new r.ModalHeaderBack),e.headerActions.show(new r.ModalHeaderInsertButton({model:t})))},getHeaderView:function(){return this.getRegion("modalHeader").currentView},getContentView:function(){return this.getRegion("modalContent").currentView},showLoadingView:function(){this.modalContent.show(new r.ModalLoadingView)},showLicenseError:function(){this.modalContent.show(new r.ModalErrorView)},showInvalidLicenseError:function(){this.modalContent.show(new r.ModalInvalidLicenseErrorView)},showDisabledElementError:function(e){var t,i=this;"container"===e?(t=new r.DisableElementModel({name:"Flexbox Container"}),i.modalContent.show(new r.ModalDisabledElementErrorView({model:t}))):s.ajax({url:ajaxurl,type:"GET",data:{action:"get_pa_element_data",element:e},success:function(e){e.data&&(console.log(e),e=new r.DisableElementModel({name:e.data.name,url:e.data.url,widgetURL:e.data.widgetURL}),i.modalContent.show(new r.ModalDisabledElementErrorView({model:e})))}})},showTemplatesView:function(e,t,i,n){this.getRegion("modalContent").show(new r.ModalBodyView);var o=this.getContentView(),a=m.getTab(),l=this.getHeaderView(),i=new r.KeywordsModel({keywords:i,activeKeyword:n});l.headerTabs.show(new r.ModalTabsView),o.contentTemplates.show(new r.ModalCollectionView({collection:e})),"premium_container"===a&&(o.searchField.show(new r.SearchFieldView),o.contentFilters.show(new r.FiltersCollectionView({collection:t})),o.contentKeywords.show(new r.KeywordsView({model:i})))}}),r.ModalLoadingView=Marionette.ItemView.extend({id:"premium-template-modal-loading",template:"#tmpl-premium-template-modal-loading"}),r.ModalErrorView=Marionette.ItemView.extend({id:"premium-template-modal-error",template:"#tmpl-premium-template-modal-error"}),r.ModalInvalidLicenseErrorView=Marionette.ItemView.extend({id:"premium-template-invalid-license-error",template:"#tmpl-premium-template-invalid-license-error"}),r.ModalDisabledElementErrorView=Marionette.ItemView.extend({id:"premium-template-disabled-element-error",template:"#tmpl-premium-template-disabled-element-error"})},masonry:{self:{},elements:{},init:function(e){var t=this;t.settings=s.extend(t.getDefaultSettings(),e),t.elements=t.getDefaultElements(),t.run()},getSettings:function(e){return e?this.settings[e]:this.settings},getDefaultSettings:function(){return{container:null,items:null,columnsCount:3,verticalSpaceBetween:30}},getDefaultElements:function(){return{$container:jQuery(this.getSettings("container")),$items:jQuery(this.getSettings("items"))}},run:function(){var a=[],l=this.elements.$container.position().top,r=this.getSettings(),s=r.columnsCount;l+=parseInt(this.elements.$container.css("margin-top"),10),this.elements.$container.height(""),this.elements.$items.each(function(e){var t=Math.floor(e/s),e=e%s,i=jQuery(this),n=i.position(),o=i[0].getBoundingClientRect().height+r.verticalSpaceBetween;t?(t=n.top-l-a[e],t-=parseInt(i.css("margin-top"),10),i.css("margin-top",(t*=-1)+"px"),a[e]+=o):a.push(o)}),this.elements.$container.height(Math.max.apply(Math,a))}}},e={PremiumSearchView:null,init:function(){this.PremiumSearchView=window.elementor.modules.controls.BaseData.extend({onReady:function(){var e=this.model.attributes.action,t=this.model.attributes.query_params;this.ui.select.find("option").each(function(e,t){s(this).attr("selected",!0)}),this.ui.select.select2({ajax:{url:function(){var i="";return 0<t.length&&s.each(t,function(e,t){window.elementor.settings.page.model.attributes[t]&&(i+="&"+t+"="+window.elementor.settings.page.model.attributes[t])}),ajaxurl+"?action="+e+i},dataType:"json"},placeholder:"Please enter 3 or more characters",minimumInputLength:3})},onBeforeDestroy:function(){this.ui.select.data("select2")&&this.ui.select.select2("destroy"),this.$el.remove()}}),window.elementor.addControlView("premium_search",this.PremiumSearchView)}},t={getDataToSave:function(e){return e.id=window.elementor.config.post_id,e},init:function(){window.elementor.settings.premium_template&&(window.elementor.settings.premium_template.getDataToSave=this.getDataToSave),window.elementor.settings.premium_page&&(window.elementor.settings.premium_page.getDataToSave=this.getDataToSave,window.elementor.settings.premium_page.changeCallbacks={custom_header:function(){this.save(function(){elementor.reloadPreview(),elementor.once("preview:loaded",function(){elementor.getPanelView().setPage("premium_page_settings")})})},custom_footer:function(){this.save(function(){elementor.reloadPreview(),elementor.once("preview:loaded",function(){elementor.getPanelView().setPage("premium_page_settings")})})}})}},m={modal:!1,layout:!1,collections:{},tabs:{},defaultTab:"",channels:{},atIndex:null,isLicenseInvalid:!0,isFilterEventAdded:!1,init:function(){window.elementor.on("preview:loaded",window._.bind(m.initPremTempsButton,m)),window.elementor.on("document:loaded",window._.bind(m.onPreviewLoaded,m)),window.elementor.channels.editor.on("section:activated",window._.bind(m.onSectionActivate,m)),l.init(),e.init(),t.init()},onPreviewLoaded:function(){window.elementor.$previewContents.on("click.addPremiumTemplate",".pa-add-section-btn",_.bind(this.showTemplatesModal,this)),this.channels={templates:Backbone.Radio.channel("PREMIUM_EDITOR:templates"),tabs:Backbone.Radio.channel("PREMIUM_EDITOR:tabs"),layout:Backbone.Radio.channel("PREMIUM_EDITOR:layout")},this.tabs=d.tabs,this.defaultTab=d.defaultTab},onSectionActivate:function(){var t=this;t.isFilterEventAdded||setTimeout(function(){t.isFilterEventAdded=!0,window.elementor.panel.$el.on("click.filterPremiumTemplate",".premium-widget-blocks",function(){var e=s(this).data("keyword");t.showTemplatesModal(t,e)})},500)},initPremTempsButton:function(){var e=setInterval(function(){var i,t;window.elementor.$previewContents.find(".elementor-add-new-section").length&&(i=s('<div class="elementor-add-section-area-button pa-add-section-btn" title="Add Premium Template"><i class="eicon-star"></i></div>'),window.elementor.$previewContents.find(".elementor-add-section-button").before(i),t=function(e,t){e=s(e.target).parents(t).prev(".elementor-add-section").find(".elementor-add-section-button");e.siblings(".pa-add-section-btn").length||e.before(i.clone())},window.elementor.$previewContents.on("click.addPremiumTemplate",".elementor-editor-section-settings .elementor-editor-element-add",function(e){t(e,".elementor-top-section")}),window.elementor.$previewContents.on("click.addPremiumTemplate",".elementor-editor-container-settings .elementor-editor-element-add",function(e){t(e,".e-parent")}),clearInterval(e))},100)},getFilter:function(e){return this.channels.templates.request("filter:"+e)},setFilter:function(e,t){this.channels.templates.reply("filter:"+e,t),this.channels.templates.trigger("filter:change")},getTab:function(){return this.channels.tabs.request("filter:tabs")},setTab:function(e,t){this.channels.tabs.reply("filter:tabs",e),t||this.channels.tabs.trigger("filter:change")},getTabs:function(){var i=[];return _.each(this.tabs,function(e,t){i.push({slug:t,title:e.title,active:t===m.getTab()})}),i},getPreview:function(){return this.channels.layout.request("preview")},setPreview:function(e,t){this.channels.layout.reply("preview",e),t||this.channels.layout.trigger("preview:change")},getKeywords:function(){return _.each(this.keywords,function(e,t){tabs.push({slug:t,title:e})}),[]},showTemplatesModal:function(e,t){var i,n,o;t||(i=(e=s(e.target).closest(".elementor-add-section")).prev(".elementor-top-section, .e-con"),n=e.next(".elementor-top-section, .e-con"),o=i.data("model-cid"),elementor.previewView.collection.length&&s.each(elementor.previewView.collection.models,function(e,t){void 0===o&&0<n.length?m.atIndex=0:o===t.cid&&(m.atIndex=e+1)})),this.getModal().show(),this.layout||(this.layout=new l.ModalLayoutView,this.layout.showLoadingView()),this.setTab(this.defaultTab,!0),this.requestTemplates(this.defaultTab,t),this.setPreview("initial"),this.setFilter("keyword",t||"")},requestTemplates:function(n,o){var a=this,e=a.tabs[n];a.setFilter("category",!1),e.data.templates&&e.data.categories?a.layout.showTemplatesView(e.data.templates,e.data.categories,e.data.keywords,o):s.ajax({url:ajaxurl,type:"get",dataType:"json",data:{action:"premium_get_templates",tab:n},success:function(e){console.log("%c Templates Retrieved Successfully!!","color: #7a7a7a; background-color: #eee;");var t=new l.LibraryCollection(e.data.templates),i=new l.CategoriesCollection(e.data.categories);a.tabs[n].data={templates:t,categories:i,keywords:e.data.keywords},a.layout.showTemplatesView(t,i,e.data.keywords,o)},error:function(e){console.log(e)}})},closeModal:function(){this.getModal().hide()},getModal:function(){return this.modal||(this.modal=elementorCommon.dialogsManager.createWidget("lightbox",{id:"premium-template-modal",className:"elementor-templates-modal",closeButton:!1,position:{my:"center",at:"center"}})),setTimeout(function(){window.dispatchEvent(new Event("resize"))},500),this.modal}};s(window).on("elementor:init",m.init)})(jQuery);